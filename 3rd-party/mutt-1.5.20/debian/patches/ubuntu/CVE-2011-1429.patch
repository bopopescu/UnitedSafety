From: Honza Horak <hhorak@redhat.com>
Description: This patch addresses a security problem due to the fact that the
 validation of the SSL CN is not correctly done in the gnutls-related code of
 mutt.
 .
 This patch has not been applied in the upstream mutt source. It is currently
 carried by Debian (1.5.21-5), Red Hat (1.5.20-2.20091214hg736b6a.el6_1.1) and,
 presumably, others. It was originally posted in the upstream mutt BTS by Honza
 Horak.
Bug: http://bugs.mutt.org/3506
Bug-Debian: http://bugs.debian.org/619216
Bug-Redhat: https://bugzilla.redhat.com/688755
Origin: other, http://bugs.mutt.org/3506#comment:8
Applied-Upstream: no

Index: mutt-1.5.20/mutt_ssl_gnutls.c
===================================================================
--- mutt-1.5.20.orig/mutt_ssl_gnutls.c	2009-06-07 01:29:17.000000000 -0500
+++ mutt-1.5.20/mutt_ssl_gnutls.c	2011-09-22 00:58:29.407444410 -0500
@@ -978,6 +978,7 @@
   unsigned int cert_list_size = 0;
   gnutls_certificate_status certstat;
   int certerr, i, preauthrc, savedcert, rc = 0;
+  int rcpeer;
 
   if (gnutls_auth_get_type (state) != GNUTLS_CRD_CERTIFICATE)
   {
@@ -1003,6 +1004,9 @@
   for (i = 0; i < cert_list_size; i++) {
     rc = tls_check_preauth(&cert_list[i], certstat, conn->account.host, i,
                            &certerr, &savedcert);
+    if (i ==0)
+      rcpeer = rc;
+
     preauthrc += rc;
 
     if (savedcert)
@@ -1028,7 +1032,7 @@
         dprint (1, (debugfile, "error trusting certificate %d: %d\n", i, rc));
 
       certstat = tls_verify_peers (state);
-      if (!certstat)
+      if (!certstat && !rcpeer)
         return 1;
     }
   }
