#!/bin/bash
	. /usr/share/cross-compile/arm-sourcery-glibc/SOURCE_ME
	./configure --host arm-linux-gnu CC=${CROSS_COMPILE}gcc --with-curses=../ncurses-5.9 CFLAGS='-Os -Xlinker -s'
	cat ./Makefile | sed 's/^DIST_SUBDIRS = m4 po intl doc contrib imap//' > ./Makefile.tmp && mv ./Makefile.tmp ./Makefile

	if [ 0 != "$?" ];then
		echo "Failed to remove DIST_SUBDIRS line from Makefile"
		exit 1
	fi

	cat ./Makefile | sed 's/^SUBDIRS = m4 po intl doc contrib $(IMAP_SUBDIR)//' > ./Makefile.tmp && mv ./Makefile.tmp ./Makefile

	if [ 0 != "$?" ];then
		echo "Failed to remove SUBDIRS line from Makefile"
		exit 1
	fi

	make -j$TRULINK_JOBS
	ret=$?

	if [ 0 != "$ret" ];then
		echo "\"make\" failed"
		exit $ret
	fi

	if [ '' != "$INSTALL" ];then

		if [ ! -e "$ROOTFS_DEF_DIR" ];then
			echo "Default rootfs directory \"$ROOTFS_DEF_DIR\" does not exist"
			exit 1
		fi

		APP="./mutt"
		sudo cp -av "$APP" "$ROOTFS_DEF_DIR/usr/bin"

		if [ 0 != "$?" ];then
			echo "Failed to install \"$APP\""
			exit 1
		fi
	fi

exit 0
