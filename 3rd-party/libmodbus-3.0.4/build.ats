#!/bin/bash
	. /usr/share/cross-compile/arm-sourcery-glibc/SOURCE_ME
	./autogen.sh
	./configure --host=arm-linux-gnu CC=${CROSS_COMPILE}gcc LD=${CROSS_COMPILE}ld AR=${CROSS_COMPILE}ar --disable-static
	make -j 4
	ret=$?
	if [ 0 != "$ret" ];then
		echo "\"make\" failed"
		exit $ret
	fi

	if [ '' != "$INSTALL" ];then

		if [ ! -e "$ROOTFS_DEF_DIR" ];then
			echo "Default rootfs directory \"$ROOTFS_DEF_DIR\" does not exist"
			exit 1
		fi

		SO='./src/.libs/libmodbus.so.5.0.3'
		${CROSS_COMPILE}strip --strip-unneeded "$SO"
		sudo cp -av "$SO" "$ROOTFS_DEF_DIR/lib/libmodbus.so.5"

		if [ 0 != "$?" ];then
			echo "Failed to install \"$SO\""
			exit 1
		fi

	fi
exit 0
