From: Eric S. Raymond <esr@thyrsus.com>
Date: Wed, 10 Mar 2010 19:00:52 +0000
Subject: [PATCH] Non-streaming operation of the Python exerciser doesn't make sense any more, and the query() entry point is gone. Fixes Debian bug #569703.

git-svn-id: svn://svn.berlios.de/gpsd/trunk@7029 3da76a2a-08e2-0310-9c3e-bc9091dd3f7d
---
 gps/gps.py |   30 ++++++++----------------------
 1 files changed, 8 insertions(+), 22 deletions(-)

diff --git a/gps/gps.py b/gps/gps.py
index 5d43824..85a5cfe 100755
--- a/gps/gps.py
+++ b/gps/gps.py
@@ -659,34 +659,20 @@ def isotime(s):
 
 if __name__ == '__main__':
     import readline, getopt
-    (options, arguments) = getopt.getopt(sys.argv[1:], "vw")
+    (options, arguments) = getopt.getopt(sys.argv[1:], "w")
     streaming = False
     verbose = False
     for (switch, val) in options:
-        if switch == '-w':
-            streaming = True    
-        elif switch == '-v':
+        if switch == '-v':
             verbose = True    
     if len(arguments) > 2:
-        print 'Usage: gps.py [host [port]]'
+        print 'Usage: gps.py [-v] [host [port]]'
         sys.exit(1)
 
-    if streaming:
-        session = gps(*arguments)
-        session.set_raw_hook(lambda s: sys.stdout.write(s.strip() + "\n"))
-        session.stream(WATCH_ENABLE|WATCH_NEWSTYLE)
-        for report in session:
-            print report
-    else:
-        print "This is the exerciser for the Python gps interface."
-        session = gps(*arguments)
-        session.set_raw_hook(lambda s: sys.stdout.write(s.strip() + "\n"))
-        try:
-            while True:
-                session.query(raw_input("> "))
-                print session
-        except EOFError:
-            print "Goodbye!"
-        del session
+    session = gps(*arguments)
+    session.set_raw_hook(lambda s: sys.stdout.write(s.strip() + "\n"))
+    session.stream(WATCH_ENABLE|WATCH_NEWSTYLE)
+    for report in session:
+        print report
 
 # gps.py ends here
-- 
